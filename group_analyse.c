#include "api.h"
#include <stdio.h> 
#include <stdbool.h> 
#include <string.h>

/*============================== perfect hash ==============================*/

int G_djs[] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 243, 0, 0, 0,
    0, 0, 0, 0, 949, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 389, 386, 0, 
    470, 0, 0, 189, 0, 0, 0, 0, 0, 0, 251, 494, 0, 0, 0, 157, 0, 0, 0, 0, 
    0, 1023, 0, 0, 0, 0, 0, 226, 142, 0, 0, 0, 0, 0, 575, 0, 0, 465, 0, 
    358, 0, 935, 0, 0, 0, 0, 31, 0, 0, 0, 0, 0, 273, 677, 89, 514, 224, 0, 
    0, 359, 0, 0, 0, 0, 0, 0, 962, 0, 1043, 0, 128, 349, 0, 0, 251, 0, 0, 
    0, 673, 0, 186, 0, 773, 0, 0, 0, 466, 165, 0, 0, 124, 0, 0, 0, 0, 0, 0, 
    0, 38, 708, 1004, 400, 201, 202, 76, 0, 1029, 807, 364, 547, 394, 0, 0, 
    124, 193, 139, 0, 0, 385, 0, 0, 337, 0, 37, 0, 0, 0, 0, 1002, 0, 931, 
    0, 0, 0, 0, 0, 0, 30, 0, 0, 227, 0, 852, 0, 246, 780, 0, 0, 0, 0, 0, 
    416, 0, 0, 0, 952, 359, 0, 279, 0, 143, 0, 252, 0, 0, 120, 888, 155, 0, 
    0, 0, 657, 0, 413, 0, 712, 0, 0, 465, 0, 0, 0, 234, 626, 0, 425, 0, 
    511, 171, 0, 462, 0, 903, 0, 0, 0, 0, 0, 0, 0, 0, 969, 211, 932, 0, 0, 
    0, 0, 942, 485, 1047, 0, 947, 212, 0, 0, 0, 84, 551, 186, 0, 0, 0, 957, 
    0, 0, 0, 0, 0, 0, 31, 0, 504, 540, 1026, 0, 376, 0, 0, 0, 0, 0, 0, 481, 
    258, 0, 824, 0, 0, 1007, 0, 0, 0, 0, 653, 531, 0, 355, 0, 140, 924, 
    241, 0, 564, 0, 356, 496, 0, 35, 0, 803, 0, 180, 221, 0, 0, 0, 1094, 0, 
    419, 0, 0, 0, 0, 769, 372, 1079, 0, 0, 0, 0, 0, 0, 0, 88, 758, 0, 0, 0, 
    0, 0, 0, 1068, 62, 0, 0, 0, 0, 0, 557, 0, 0, 1002, 67, 0, 0, 0, 0, 748, 
    0, 91, 0, 332, 509, 288, 0, 265, 151, 0, 0, 0, 0, 0, 0, 0, 341, 0, 203, 
    333, 884, 1048, 172, 387, 0, 189, 515, 698, 0, 188, 1004, 0, 108, 0, 0, 
    0, 797, 0, 0, 276, 424, 166, 0, 269, 203, 0, 9, 307, 0, 638, 0, 0, 239, 
    332, 0, 0, 626, 831, 376, 425, 979, 0, 0, 0, 0, 656, 113, 0, 635, 321, 
    988, 0, 0, 496, 0, 0, 0, 0, 551, 0, 317, 0, 427, 0, 0, 0, 0, 0, 0, 975, 
    563, 0, 252, 203, 213, 0, 501, 916, 0, 272, 237, 0, 0, 776, 1011, 0, 
    881, 0, 0, 0, 0, 486, 1008, 0, 236, 0, 270, 0, 0, 0, 0, 44, 290, 0, 0, 
    0, 431, 0, 0, 806, 807, 0, 0, 1032, 297, 957, 53, 372, 0, 169, 979, 0, 
    371, 0, 184, 988, 0, 0, 444, 0, 0, 1003, 952, 287, 0, 0, 493, 158, 903, 
    124, 0, 0, 425, 0, 267, 0, 0, 18, 197, 119, 0, 88, 0, 177, 0, 0, 512, 
    738, 0, 305, 0, 162, 0, 871, 0, 0, 31, 926, 0, 0, 408, 711, 272, 633, 
    0, 362, 32, 0, 858, 0, 1089, 605, 30, 0, 822, 1, 0, 0, 0, 0, 881, 575, 
    0, 168, 533, 1060, 37, 568, 920, 0, 94, 0, 257, 0, 0, 90, 374, 788, 0, 
    0, 60, 602, 326, 259, 0, 843, 469, 499, 4, 0, 302, 437, 228, 0, 305, 0, 
    415, 994, 458, 0, 0, 560, 343, 372, 50, 0, 312, 1027, 0, 53, 0, 0, 700, 
    1062, 1046, 474, 541, 0, 378, 459, 299, 130, 0, 0, 0, 388, 686, 382, 0, 
    0, 74, 0, 231, 700, 0, 899, 0, 0, 7, 0, 347, 0, 0, 0, 0, 555, 941, 936, 
    0, 207, 553, 200, 0, 410, 244, 277, 0, 344, 113, 633, 161, 0, 869, 189, 
    151, 319, 129, 547, 900, 202, 0, 0, 244, 0, 0, 511, 488, 1029, 0, 0, 0, 
    0, 249, 0, 0, 0, 0, 281, 581, 0, 0, 0, 0, 27, 1081, 15, 1017, 385, 132, 
    0, 441, 0, 463, 0, 467, 876, 0, 0, 0, 393, 0, 690, 0, 0, 0, 0, 370, 0, 
    0, 479, 0, 0, 336, 414, 882, 0, 0, 984, 0, 126, 175, 128, 418, 0, 796, 
    0, 0, 0, 0, 0, 683, 24, 220, 0, 0, 0, 821, 128, 80, 0, 486, 242, 0, 
    452, 133, 284, 426, 0, 170, 163, 0, 228, 1041, 0, 0, 0, 0, 446, 56, 
    988, 0, 688, 606, 144, 19, 0, 472, 0, 0, 0, 0, 892, 1045, 0, 404, 0, 
    1015, 0, 968, 0, 131, 0, 1102, 0, 1084, 316, 0, 368, 0, 615, 1071, 392, 
    0, 58, 0, 715, 147, 0, 353, 0, 451, 0, 897, 0, 228, 436, 426, 0, 0, 
    193, 471, 406, 0, 135, 376, 0, 0, 934, 0, 0, 0, 324, 0, 1059, 748, 75, 
    613, 660, 0, 798, 360, 0, 154, 333, 1045, 0, 0, 0, 175, 432, 0, 233, 
    1048, 544, 0, 802, 0, 0, 749, 1053, 551, 407, 66, 258, 416, 0, 0, 251, 
    139, 0, 395, 0, 0, 344, 804, 808, 0, 1014, 0, 209, 506, 910, 463, 215, 
    465, 0, 0, 223, 137, 0, 0, 81, 457, 201, 57, 304, 0, 502, 94, 256, 784, 
    1018, 0, 225, 0, 0, 500, 1101, 344, 120, 529, 937, 0, 447, 800, 342, 
    141, 907, 248, 0, 0, 0, 0, 0, 0, 238, 0, 0, 0, 150, 0, 51, 339, 0, 4, 
    95, 939, 117, 54, 70, 917, 988, 977, 0, 104, 771, 0, 0, 0, 102, 142, 
    162, 111, 382, 489, 192, 661, 442, 646, 453, 927, 78, 620, 149, 218, 
    109, 0, 0, 0, 472, 437, 0, 343, 0, 907, 67, 0, 0, 34, 172, 191, 0, 466, 
    720, 0, 0, 307, 329, 508, 910, 492, 0, 153, 0, 0, 112, 72, 755, 10, 0, 
    0, 0, 541, 254, 317, 374, 511, 0, 0, 68, 0, 0, 0, 777, 0, 0, 71, 0, 0, 
    0, 261, 183, 0, 0, 0, 0, 1036, 0, 0, 0, 544, 1025, 0, 489, 17, 666, 10, 
    428, 505, 240, 0, 264, 0, 400, 789, 0, 388, 0, 94, 1059, 0, 381, 16, 
    251, 130, 243, 0, 0, 52, 938, 0, 0, 0, 774, 929, 328, 558, 67, 7, 0, 
    303, 956, 285, 173, 0, 383, 0, 160, 0, 118, 434, 596, 260, 0, 0, 1026, 
    74, 93, 744, 1052, 0, 0, 0};

const char *hash_str1 = "4OIVTNivAed";
const char *hash_str2 = "sb3O1pqWwu5";

int hash_f_djs(char *key, const char *T) {
    int sum = 0, i = 0;
    while( key[i] != '\0') {
        if (i == 0) sum += (T[i%11] * (key[i]+32));
        else sum += T[i%11] * key[i];
        i++;
    }
    return sum % 1103;
}

int perfect_hash_djs(char *key) {
    return (G_djs[hash_f_djs(key, hash_str1)] + G_djs[hash_f_djs(key, hash_str2)]) % 1103;
}
/*============================== perfect hash ==============================*/

// global variables
int n_mails, n_queries;
mail *mails;
query *queries;

bool people[560]; // 560 whether a person has been added
int parent[600];
int size[600];
int ng, lg;
int ans_djs[2];

// for faster clear()
int cnt_djs;
int used_djs[560]; // can reuse any other array (don't have to be clear) to save memory usage


// functions

int findSet(int i) {

    // path compression
    if ( i != parent[i] ) parent[i] = findSet(parent[i]);
    else return i;

    return parent[i];
}

void linkSet(int i, int j) {
    int si = findSet(i);
    int sj = findSet(j);

    if (si != sj) {
        if (size[si] >= size[sj]) {
            parent[sj] = si;
            size[si] += size[sj];

            if (lg < size[si]) lg = size[si];

        } else {
            parent[si] = sj;
            size[sj] += size[si];

            if (lg < size[sj]) lg = size[sj];
        }
        ng--;
    }

    return;
}

void makeSet(int i, int j) { 

    if (!people[i] && !people[j]) {
        
        parent[i] = i;
        size[i] = 2;
        people[i] = true;

        parent[j] = i;
        people[j] = true;

        ng++;
        if (lg < 2) lg = 2;

		used_djs[cnt_djs++] = i;
		used_djs[cnt_djs++] = j;

    } else if (!people[i]) {

        parent[i] = findSet(j);
        size[parent[i]]++;
        people[i] = true;

        if (lg < size[parent[i]]) lg = size[parent[i]];

		used_djs[cnt_djs++] = i;

    } else if (!people[j]) {

        parent[j] = findSet(i);
        size[parent[j]]++;
        people[j] = true;

		used_djs[cnt_djs++] = j;
        
        if (lg < size[parent[j]]) lg = size[parent[j]];

    } else {
        linkSet(i, j);
    }

    return;
}

void clear() {
	for (int i = 0; i < cnt_djs; i++) {
		int p = used_djs[i];
		people[p] = 0;
		parent[p] = 0;
		size[p] = 0;
	}
}


int main() {


    // init
    api.init(&n_mails, &n_queries, &mails, &queries);
    

    for (int i = 0; i < n_queries; i++) {

        if (queries[i].type == group_analyse) {

            // init
            ng = 0;
            lg = 0;
			cnt_djs = 0;

            // fetch data
            int len = queries[i].data.group_analyse_data.len;
            int *mids = queries[i].data.group_analyse_data.mids;

            for (int j = 0; j < len; j++) {

                mail m = mails[mids[j]];
                
                // get sender's and receiver's hash value
                int from = perfect_hash_djs(m.from);
                int to = perfect_hash_djs(m.to);

                makeSet(from, to);

            }

            // output
            ans_djs[0] = ng;
            ans_djs[1] = lg;
            api.answer(i, ans_djs, 2);

            clear();
        }
    }

    return 0;
}
